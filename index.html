<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shaking Text Animation & Audio Recorder</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes shakeText {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        .rotating-text {
            font-size: 24px;
            font-weight: bold;
            color: #ff4081;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
            animation: shakeText 0.5s ease-in-out infinite;
            display: inline-block;
            margin-bottom: 20px;
        }
    </style>
</head>
<body class="flex flex-col items-center justify-center h-screen bg-gradient-to-r from-blue-100 to-purple-200">
    <div class="absolute left-5 top-5">
        <button id="cameraButton" class="px-4 py-2 bg-green-500 text-white font-bold rounded-lg shadow hover:bg-green-400 transition">เปิดกล้อง</button>
        <button id="recordButton" class="px-4 py-2 bg-red-500 text-white font-bold rounded-lg shadow hover:bg-red-400 transition mt-2" disabled>อัดวิดีโอ</button>
    </div>
    <div class="rotating-text">สวัสดี พี่เอส พี่เอ็ม พี่แอ๊กซ์ ด้วยนะครับ v3</div>
    <video id="video" class="mt-4" width="320" height="240" autoplay></video>
    <script>
        let mediaRecorder;
        let chunks = [];
        const cameraButton = document.getElementById('cameraButton');
        const recordButton = document.getElementById('recordButton');
        const video = document.getElementById('video');

        cameraButton.addEventListener('click', async () => {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: true,
                    audio: { echoCancellation: true, noiseSuppression: true }
                });
                video.srcObject = stream;
                recordButton.disabled = false;
                
                mediaRecorder = new MediaRecorder(stream);
                mediaRecorder.ondataavailable = event => chunks.push(event.data);
                mediaRecorder.onstop = () => {
                    const blob = new Blob(chunks, { type: 'video/mp4' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'recorded-video.mp4';
                    a.click();
                    chunks = [];
                };
            } catch (error) {
                console.error('Error accessing camera or microphone:', error);
                alert('กรุณาอนุญาตให้ใช้กล้องและไมโครโฟน');
            }
        });

        recordButton.addEventListener('click', () => {
            if (mediaRecorder.state === 'inactive') {
                mediaRecorder.start();
                recordButton.textContent = 'หยุดอัดวิดีโอ';
            } else {
                mediaRecorder.stop();
                recordButton.textContent = 'อัดวิดีโอ';
            }
        });

        // ขออนุญาตเข้าถึงไมโครโฟนทันทีเมื่อโหลดหน้าเว็บ
        navigator.mediaDevices.getUserMedia({ audio: true })
            .then(stream => console.log('Microphone access granted'))
            .catch(error => console.error('Microphone access denied:', error));
    </script>
</body>
</html>
